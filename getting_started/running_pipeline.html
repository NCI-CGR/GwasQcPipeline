

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running the Pipeline &mdash; GwasQcPipeline 1.5.1rc2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration Files" href="configuration.html" />
    <link rel="prev" title="Installing GwasQcPipeline" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> GwasQcPipeline
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing GwasQcPipeline</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running the Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-configuration">Creating Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cgr-config">cgr config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pre-flight-file-checks">Pre-Flight File Checks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cgr-pre-flight">cgr pre-flight</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-workflow-locally">Running the Workflow Locally</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cgr-snakemake">cgr snakemake</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-workflow-on-a-cluster">Running the Workflow on a Cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cgr-submit">cgr submit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Files</a></li>
</ul>
<p><span class="caption-text">QC Sub Workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sub_workflows/entry_points.html">Entry Points Sub-workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sub_workflows/contamination.html">Contamination Sub-workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sub_workflows/sample_qc.html">Sample QC Sub-workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sub_workflows/subject_qc.html">Subject QC Sub-workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sub_workflows/delivery.html">Delivery Sub-workflow</a></li>
</ul>
<p><span class="caption-text">User Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/file_types.html">File Type Reference</a></li>
</ul>
<p><span class="caption-text">Developer Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/setup.html">Development Environment Set-up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/documentation.html">Working with Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/source_code.html">Working with Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/testing.html">Working with Test Suite</a></li>
</ul>
<p><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/cgr_gwas_qc.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GwasQcPipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Running the Pipeline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/getting_started/running_pipeline.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="running-the-pipeline">
<h1>Running the Pipeline<a class="headerlink" href="#running-the-pipeline" title="Permalink to this headline">¶</a></h1>
<p>There are three phases to running the <em>CGR GwasQcPipeline</em>: configuration, pre-flight checks, and running snakemake or submitting to a cluster.</p>
<section id="creating-configuration">
<span id="cgr-config"></span><h2>Creating Configuration<a class="headerlink" href="#creating-configuration" title="Permalink to this headline">¶</a></h2>
<p>Before running the <em>CGR GwasQcPipeline</em> we need to create the necessary configuration file (<code class="docutils literal notranslate"><span class="pre">config.yml</span></code>).
We provide a command line utility (<code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">config</span></code>) to help generate this file.
To run this utility you need to provide a sample sheet (or CGR LIMs manifest).
Please see <a class="reference internal" href="configuration.html#sample-sheet"><span class="std std-ref">Sample Sheet File</span></a> to see the sample sheet requirements.
For more details on the available configuration options see <a class="reference internal" href="configuration.html#config-yaml"><span class="std std-ref">The config.yml</span></a></p>
<section id="cgr-config">
<h3>cgr config<a class="headerlink" href="#cgr-config" title="Permalink to this headline">¶</a></h3>
<p>Create the CGR GwasQcPipline’s configuration file (<code class="docutils literal notranslate"><span class="pre">config.yml</span></code>).</p>
<p><strong>CGEMs/CCAD Users</strong></p>
<p>For CGR users on CGEMs/CCAD you will probably want to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cgr config --cgems -s &lt;path to lims manifest file&gt;
</pre></div>
</div>
<p>This will create the default production run folder structure in
<code class="docutils literal notranslate"><span class="pre">GSA_Lab_QC/&lt;project&gt;/builds/QC_v#_######</span></code>. This will also populate
<code class="docutils literal notranslate"><span class="pre">config.yml</span></code> with CGEMs/CCAD file locations and naming patterns. If you do
not want to create the production folder structure then you can use the
<code class="docutils literal notranslate"><span class="pre">--cgems-dev</span></code> option instead of <code class="docutils literal notranslate"><span class="pre">--cgems</span></code>.</p>
<p><strong>Other Users</strong></p>
<p>Non-CGR users and CGR users on other systems will probably want to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cgr config \
      --sample-sheet &lt;path to lims manifest file or sample sheet&gt; \
      --project-name &lt;my_project_name&gt; \
      [--slurm-partition &lt;partition_name&gt;]
</pre></div>
</div>
<p>This will generate the <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file in the current working directory,
with placeholders for reference files and user files.
Slurm users can include the <code class="docutils literal notranslate"><span class="pre">--slurm-partition</span></code> option to specify
the name of the queue to which your jobs will be submitted.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Always review and update <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> before each pipeline run.
Then run <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">pre-flight</span></code> to ensure proper configuration.</p>
</aside>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The sample sheet must exist and be readable.
An error will be raised if it is not.</p>
</aside>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cgr<span class="w"> </span>config<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt id="cmdoption-cgr-config-s">
<span id="cmdoption-cgr-config-sample-sheet"></span><code class="sig-name descname">-s</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--sample-sheet</code><code class="sig-prename descclassname"> &lt;sample_sheet&gt;</code><a class="headerlink" href="#cmdoption-cgr-config-s" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>Required</strong> Path to a sample sheet or CGR LIMs manifest file.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-bpm-file">
<code class="sig-name descname">--bpm-file</code><code class="sig-prename descclassname"> &lt;bpm_file&gt;</code><a class="headerlink" href="#cmdoption-cgr-config-bpm-file" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to the Illumina BPM file used to generate the data.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-genome-build">
<code class="sig-name descname">--genome-build</code><code class="sig-prename descclassname"> &lt;genome_build&gt;</code><a class="headerlink" href="#cmdoption-cgr-config-genome-build" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the human genome build to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>GenomeBuild.hg37</p>
</dd>
<dt class="field-even">Options<span class="colon">:</span></dt>
<dd class="field-even"><p>hg37 | hg38</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-project-name">
<code class="sig-name descname">--project-name</code><code class="sig-prename descclassname"> &lt;project_name&gt;</code><a class="headerlink" href="#cmdoption-cgr-config-project-name" title="Permalink to this definition">¶</a></dt>
<dd><p>The project name to use for this QC run.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-slurm-partition">
<code class="sig-name descname">--slurm-partition</code><code class="sig-prename descclassname"> &lt;slurm_partition&gt;</code><a class="headerlink" href="#cmdoption-cgr-config-slurm-partition" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the Slurm partition to which jobs will be submitted. This is required when running <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">submit</span> <span class="pre">--slurm</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-u">
<span id="cmdoption-cgr-config-include-unused-settings"></span><code class="sig-name descname">-u</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--include-unused-settings</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-config-u" title="Permalink to this definition">¶</a></dt>
<dd><p>Include unused settings in the config. To keep the config file tidy, we do not output non-required settings that are set as <code class="docutils literal notranslate"><span class="pre">None</span></code>. With this option, we will output all settings, which maybe especially useful for new users.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-cgems">
<code class="sig-name descname">--cgems</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-config-cgems" title="Permalink to this definition">¶</a></dt>
<dd><p>Create folder structure for a production run on CGEMs/CCAD. Then use standard paths for CGEMs/CCAD.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-cgems-dev">
<code class="sig-name descname">--cgems-dev</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-config-cgems-dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Use CGEMs/CCAD standard paths but create the config in the current working directory. This is particularly useful for testing.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-config-y">
<code class="sig-name descname">-y</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-config-y" title="Permalink to this definition">¶</a></dt>
<dd><p>Don’t prompt during CGEMs/CCAD folder creation. Note: this option is only used with <code class="docutils literal notranslate"><span class="pre">--cgems</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="pre-flight-file-checks">
<span id="cgr-preflight"></span><h2>Pre-Flight File Checks<a class="headerlink" href="#pre-flight-file-checks" title="Permalink to this headline">¶</a></h2>
<p>A fundamental design strategy of this project is to fail fast if there is a problem.
A common source of problems are input reference/user files.
We provide the <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">pre-flight</span></code> command, which tries to validate all input files to make sure that they are (1) present, (2) readable, and (3) complete.
This command also creates <code class="docutils literal notranslate"><span class="pre">cgr_sample_sheet.csv</span></code> which is required by the workflow.
See below for more details about what all <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">pre-flight</span></code> does.</p>
<p>Here is example output where checks pass:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sample</span> <span class="n">Sheet</span> <span class="n">OK</span> <span class="p">(</span><span class="n">sample</span><span class="o">-</span><span class="n">sheet</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="n">csv</span><span class="p">)</span>
<span class="n">BPM</span> <span class="n">OK</span> <span class="p">(</span><span class="n">bpm</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="n">bpm</span><span class="p">)</span>
<span class="n">VCF</span> <span class="n">OK</span> <span class="p">(</span><span class="n">vcf</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">gz</span><span class="p">)</span>
<span class="n">VCF</span><span class="o">.</span><span class="n">TBI</span> <span class="n">OK</span> <span class="p">(</span><span class="n">tbi</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">name</span><span class="o">.</span><span class="n">vcf</span><span class="o">.</span><span class="n">gz</span><span class="o">.</span><span class="n">tbi</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">GTC</span> <span class="n">files</span>
  <span class="p">[</span><span class="c1">#################################] 100%</span>
<span class="mi">7</span><span class="p">,</span><span class="mi">231</span> <span class="n">GTC</span> <span class="n">Files</span> <span class="n">OK</span><span class="o">.</span>
</pre></div>
</div>
<p>Here is example output with two missing GTC files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Missing a few GTC files
$ cgr pre-flight
Sample Sheet OK (sample-sheet-name.csv)
BPM OK (bpm-file-name.bpm)
VCF OK (vcf-file-name.vcf.gz)
VCF.TBI OK (tbi-file-name.vcf.gz.tbi)
Processing GTC files
  [#################################] 100%
There was a problem with these GTC Files:
  FileNotFound:
    - missing-gtc-file1.gtc
    - missing-gtc-file2.gtc
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">config.yml</span></code>, sample sheet, or reference files have any issues you must fix them before continuing.
If you are missing a few sample’s IDAT or GTC files you may decide to continue;
the workflow will automatically exclude these samples.</p>
</aside>
<section id="cgr-pre-flight">
<h3>cgr pre-flight<a class="headerlink" href="#cgr-pre-flight" title="Permalink to this headline">¶</a></h3>
<p>Check all input files to make sure they are readable and complete.</p>
<p><strong>Included Checks</strong>. <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">pre-fight</span></code> first checks the <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file makes sure all config settings are valid.
It then reads the sample sheet (or LIMS manifest file) and checks that all columns defined in the config are present.
These include <code class="docutils literal notranslate"><span class="pre">workflow_params.subject_id_column</span></code>, <code class="docutils literal notranslate"><span class="pre">workflow_params.expected_sex_column</span></code>, and <code class="docutils literal notranslate"><span class="pre">workflow_params.case_control_column</span></code>.
Next it checks all reference files (BPM, VCF, TBI) and makes sure that they exist, are readable, and complete.
Finally, it will search for all IDAT and GTC files if <code class="docutils literal notranslate"><span class="pre">user_files.idat_pattern</span></code> and <code class="docutils literal notranslate"><span class="pre">user_files.gtc_pattern</span></code> are defined.
Again, it makes sure all files exist, are readable, and are complete.</p>
<p><strong>File Updates</strong>.
This step also updates the <code class="docutils literal notranslate"><span class="pre">config.yml</span></code> file with the <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> (from the sample sheet) and the <code class="docutils literal notranslate"><span class="pre">num_snps</span></code> (from the BPM file).</p>
<p><strong>Creates ``cgr_sample_sheet.csv``</strong>.
Finally, this step creates a normalized version of the sample sheet (or LIMs manifest).
This include all of the columns in the sample sheet as well as the following added columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Group_By_Subject_ID</span></code>: a column with the subject ID to use for subject level qc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expected_sex</span></code>: copies the expected sex column from the config.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">case_control</span></code>: copies the case control column from the config.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_internal_control</span></code>: a flag indicating if the sample is a CGR internal control (i.e., sVALID-001).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_user_exclusion</span></code>: a flag indicating if the sample was marked to be excluded in the config.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_missing_idats</span></code>: a flag indicating if the sample was missing an IDAT file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_missing_gtc</span></code>: a flag indicating if the sample was missing its GTC file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_sample_exclusion</span></code>: a flag indicating if the sample had missing IDAT or GTC files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_samples_per_subject</span></code>: The number of samples per subject.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replicate_ids</span></code>: A concatenated list of Sample_IDs from reach subject.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cluster_group</span></code>: Group names used when running on a cluster in the form of <code class="docutils literal notranslate"><span class="pre">cgroup#</span></code>.</p></li>
</ul>
<p>You will almost always run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cgr pre-flight --threads 4
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cgr<span class="w"> </span>pre-flight<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-config-file">
<code class="sig-name descname">--config-file</code><code class="sig-prename descclassname"> &lt;config_file&gt;</code><a class="headerlink" href="#cmdoption-cgr-pre-flight-config-file" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to the configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>config.yml</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-no-reference-files-check">
<code class="sig-name descname">--no-reference-files-check</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-pre-flight-no-reference-files-check" title="Permalink to this definition">¶</a></dt>
<dd><p>Skip checks of reference files. Not suggested.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-no-user-files-check">
<code class="sig-name descname">--no-user-files-check</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-pre-flight-no-user-files-check" title="Permalink to this definition">¶</a></dt>
<dd><p>Skip checks of user files. Not suggested.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-no-update-config">
<code class="sig-name descname">--no-update-config</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-pre-flight-no-update-config" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not update the config file. Not suggested.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-j">
<span id="cmdoption-cgr-pre-flight-threads"></span><code class="sig-name descname">-j</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--threads</code><code class="sig-prename descclassname"> &lt;threads&gt;</code><a class="headerlink" href="#cmdoption-cgr-pre-flight-j" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of theads to use when checking user files.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>4</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-pre-flight-cluster-group-size">
<code class="sig-name descname">--cluster-group-size</code><code class="sig-prename descclassname"> &lt;cluster_group_size&gt;</code><a class="headerlink" href="#cmdoption-cgr-pre-flight-cluster-group-size" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of samples to group to gether when running in cluster mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>1000</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="running-the-workflow-locally">
<span id="cgr-snakemake"></span><h2>Running the Workflow Locally<a class="headerlink" href="#running-the-workflow-locally" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">snakemake</a> to orchestrate the <em>CGR GwasQcPipeline</em>.
We provide <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">snakemake</span></code> to simplify running <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">snakemake</a> directly.</p>
<section id="cgr-snakemake">
<h3>cgr snakemake<a class="headerlink" href="#cgr-snakemake" title="Permalink to this headline">¶</a></h3>
<p>A light weight wrapper around snakemake.</p>
<p>The purpose of this wrapper is to allow interacting with snakemake directly,
while hiding some of the implementation details. The key feature of this
wrapper is to tell snakemake where the workflow’s snakefile exists.  We do
this by adding the <cite>-s</cite> option to your snakemake command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snakemake</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">workflow</span> <span class="n">install</span> <span class="n">location</span><span class="o">&gt;</span> <span class="n">OPTIONS</span> <span class="n">TARGETS</span>
</pre></div>
</div>
<p>In addition, we also add some snakemake options if you did not specify them.
This is mostly for convenience.  Specifically, we require the use of
<code class="docutils literal notranslate"><span class="pre">conda</span></code>, so we always will add <code class="docutils literal notranslate"><span class="pre">--use-conda</span></code>.  Second, in recent
versions of snakemake they no longer default to <code class="docutils literal notranslate"><span class="pre">--cores</span> <span class="pre">1</span></code> and will throw
an error if you did not specify a value.  We find this annoying, so we will
always add <code class="docutils literal notranslate"><span class="pre">--cores</span> <span class="pre">1</span></code> unless you provide a value.</p>
<p>So for example, to run the full workflow locally you will typically run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">snakemake</span> <span class="o">--</span><span class="n">cores</span> <span class="mi">8</span> <span class="o">-</span><span class="n">k</span>
</pre></div>
</div>
<p>This will be translated into:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snakemake</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">workflow</span> <span class="n">install</span> <span class="n">location</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">cores</span> <span class="mi">8</span> <span class="o">-</span><span class="n">k</span> <span class="o">--</span><span class="n">use</span><span class="o">-</span><span class="n">conda</span>
</pre></div>
</div>
<p>Instead of running the entire workflow, you can also run specific
sub-workflow by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">snakemake</span> <span class="o">--</span><span class="n">cores</span> <span class="mi">8</span> <span class="o">-</span><span class="n">k</span> <span class="o">--</span><span class="n">subworkflow</span> <span class="n">sample_qc</span>
</pre></div>
</div>
<dl class="simple">
<dt>Args:</dt><dd><dl class="simple">
<dt>subworkflow (str):</dt><dd><p>Specify which sub-workflow to run [default: None].
Must be one of [<code class="docutils literal notranslate"><span class="pre">entry_points</span></code> | <code class="docutils literal notranslate"><span class="pre">contamination</span></code> | <code class="docutils literal notranslate"><span class="pre">sample_qc</span></code> | <code class="docutils literal notranslate"><span class="pre">subject_qc</span></code> | <code class="docutils literal notranslate"><span class="pre">delivery</span></code>].</p>
</dd>
<dt>other-kwargs:</dt><dd><p>All snakemake arguments will be passed to snakemake.
See their documentation for possible options.</p>
</dd>
</dl>
</dd>
<dt>References:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">https://snakemake.readthedocs.io/en/stable/</a></p></li>
</ul>
</dd>
</dl>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cgr<span class="w"> </span>snakemake<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<section id="running-the-workflow-on-a-cluster">
<span id="cgr-submit"></span><h2>Running the Workflow on a Cluster<a class="headerlink" href="#running-the-workflow-on-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>We provide the <code class="docutils literal notranslate"><span class="pre">cgr</span> <span class="pre">submit</span></code> command to easily submit to a cluster.
We take advantage of <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/">snakemake</a>’s cluster profile system to run on different cluster environments.
For CGR users, we include cluster profiles for <code class="docutils literal notranslate"><span class="pre">CGEMS/CCAD</span></code>, <code class="docutils literal notranslate"><span class="pre">ccad2</span></code>, and <code class="docutils literal notranslate"><span class="pre">Biowulf</span></code>.
For external users will need to create your own <a class="reference external" href="https://github.com/snakemake-profiles/doc">snakemake cluster profile</a>.</p>
<section id="cgr-submit">
<h3>cgr submit<a class="headerlink" href="#cgr-submit" title="Permalink to this headline">¶</a></h3>
<p>Submit the CGR GwasQcPipeline to a cluster for execution.</p>
<p>The <cite>cgr submit</cite> command will create a submission script and submit it to the cluster.
We will create an optimized submission script for users of CGEMs/CCAD, CCAD2 and Biowulf.
For other systems you will need to provide a snakemake cluster profile to tell snakemake how use your system.
If you are submitting to a Slurm cluster, you can use the generic Slurm cluster profile we provide by including the <cite>–slurm</cite> option in your submit command.</p>
<p>Users running on CGEMs/CCAD will typically run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">submit</span> <span class="o">--</span><span class="n">cgems</span>
</pre></div>
</div>
<p>Users running on Biowulf will typically run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">submit</span> <span class="o">--</span><span class="n">biowulf</span>
</pre></div>
</div>
<p>Users running on CCAD2 will typically run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">submit</span> <span class="o">--</span><span class="n">ccad2</span>
</pre></div>
</div>
<p>Users running on other Slurm systems will typically run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgr</span> <span class="n">submit</span> <span class="o">--</span><span class="n">slurm</span>
</pre></div>
</div>
<p>Users running with a custom cluster profile will typically run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cgr submit \
    --profile &lt;path to custom cluster profile&gt; \
    --queue &lt;name of the queue to submit main job&gt; \
    --submission-cmd &lt;tool used for submit such as sbatch or qsub&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes it may be useful to edit the submission script before submitting it to the cluster.
In that case you can add the <cite>–dry-run</cite> option and edit the generated file in <cite>.snakemake/GwasQcPipeline_submission.sh</cite>.
You would then submit this script directly to your cluster (i.e., <cite>qsub .snakemake/GwasQcPipeline_submission.sh</cite>).</p>
</aside>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cgr<span class="w"> </span>submit<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt id="cmdoption-cgr-submit-cgems">
<span id="cmdoption-cgr-submit-no-cgems"></span><code class="sig-name descname">--cgems</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-cgems</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-cgems" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the workflow using the CGEMs/CCAD cluster profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-biowulf">
<span id="cmdoption-cgr-submit-no-biowulf"></span><code class="sig-name descname">--biowulf</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-biowulf</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-biowulf" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the workflow using the cli Biowulf cluster profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-ccad2">
<span id="cmdoption-cgr-submit-no-ccad2"></span><code class="sig-name descname">--ccad2</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-ccad2</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-ccad2" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the workflow using the cli ccad2 cluster profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-slurm">
<span id="cmdoption-cgr-submit-no-slurm"></span><code class="sig-name descname">--slurm</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-slurm</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-slurm" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the workflow using the generic slurm cluster profile. This option requires that you specify the <cite>slurm_partition</cite> in the <cite>config.yml</cite> file.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-cluster-profile">
<code class="sig-name descname">--cluster-profile</code><code class="sig-prename descclassname"> &lt;cluster_profile&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-cluster-profile" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to a custom cluster profile. See <a class="reference external" href="https://github.com/snakemake-profiles/doc">https://github.com/snakemake-profiles/doc</a>.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-subworkflow">
<code class="sig-name descname">--subworkflow</code><code class="sig-prename descclassname"> &lt;subworkflow&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-subworkflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a sub-workflow instead of the full workflow.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-time-hr">
<code class="sig-name descname">--time-hr</code><code class="sig-prename descclassname"> &lt;time_hr&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-time-hr" title="Permalink to this definition">¶</a></dt>
<dd><p>The walltime limit (in hours) for the main snakemake process. Ignored if using <cite>–cgems</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>120</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-queue">
<code class="sig-name descname">--queue</code><code class="sig-prename descclassname"> &lt;queue&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the queue for the main process to use. This option is required if you are using <cite>–cluster-profile</cite>. CGEMs/CCAD, CCAD2, and Biowulf users may want to use this to override which queue to use for the main process.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-submission-cmd">
<code class="sig-name descname">--submission-cmd</code><code class="sig-prename descclassname"> &lt;submission_cmd&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-submission-cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the command to use for submission (i.e., qsub, sbatch). This is required if you are using <cite>–cluster-profile</cite>. Ignored if using <cite>–cgems</cite> or <cite>–biowulf</cite> or <cite>–ccad2</cite>.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-dry-run">
<span id="cmdoption-cgr-submit-no-dry-run"></span><code class="sig-name descname">--dry-run</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-dry-run</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-dry-run" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the submission script but do not send to the schedular. The generate submission script is in <cite>.snakemake/GwasQcPipeline_submission.sh</cite>. This file can be edited and submitted directly to the cluster.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-notemp">
<span id="cmdoption-cgr-submit-no-notemp"></span><code class="sig-name descname">--notemp</code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname">, </code><code class="sig-name descname">--no-notemp</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-cgr-submit-notemp" title="Permalink to this definition">¶</a></dt>
<dd><p>Do not delete temporary files. This option runs the workflow using <cite>snakemake –notemp</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>False</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-local-mem-mb">
<code class="sig-name descname">--local-mem-mb</code><code class="sig-prename descclassname"> &lt;local_mem_mb&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-local-mem-mb" title="Permalink to this definition">¶</a></dt>
<dd><p>The amount of memory to use for main snakemake process and local rules [default 8GB]. There are a number of rules that are run along side of the main snakemake process instead of submitting a new job. If you have a very large project &gt;50k samples, you may want to increase the amount of memory used for this job. Ignored if using <cite>–cgems</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>8000</p>
</dd>
</dl>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-cgr-submit-local-tasks">
<code class="sig-name descname">--local-tasks</code><code class="sig-prename descclassname"> &lt;local_tasks&gt;</code><a class="headerlink" href="#cmdoption-cgr-submit-local-tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of threads for the main snakemake process and local rules.There are a number of rules that are run along side of the main snakemake process instead of submitting a new job. If you have a very large project &gt;50k samples, you may want to increase the number of CPUs used for this job. Ignored if using <cite>–cgems</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Default<span class="colon">:</span></dt>
<dd class="field-odd"><p>4</p>
</dd>
</dl>
</dd></dl>

</section>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>External users on a SLURM or SGE cluster, may just want to modify one of our <a class="reference external" href="https://github.com/NCI-CGR/GwasQcPipeline/tree/default/src/cgr_gwas_qc/cluster_profiles">profiles</a>.</p>
</aside>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><strong>Biowulf users</strong>.
You may need to adjust <code class="docutils literal notranslate"><span class="pre">--time-hr</span></code>, <code class="docutils literal notranslate"><span class="pre">--local_mem_mb</span></code>, and <code class="docutils literal notranslate"><span class="pre">--local_tasks</span></code>
if your main job is getting killed by the cluster because of resource limits.</p>
</aside>
<p>The submission script will create a log file <code class="docutils literal notranslate"><span class="pre">./gwas_qc_log.$JOB_ID</span></code> that will have the status of your cluster submission.
Logs for each submitted job can be found in <code class="docutils literal notranslate"><span class="pre">./logs/</span></code>.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration Files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installing GwasQcPipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Leidos Biomedical Research, Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>